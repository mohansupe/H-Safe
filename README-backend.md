# H-SAFE Backend (Bundle 2) — Vercel Serverless Functions

This bundle contains serverless endpoints ready to deploy to Vercel.
They use Supabase (Postgres) for storage and Resend for email notifications.

## Files included
- api/feedback.js         -> accepts POST {name,email,message} and inserts into `feedback` table
- api/contact.js          -> accepts POST {name,email,message} and inserts into `contact_messages` table
- api/admin-feedback.js   -> GET, returns all feedback (admin auth required)
- api/delete-feedback.js  -> POST {id} to delete a feedback entry (admin auth required)
- api/delete-contact.js   -> POST {id} to delete a contact entry (admin auth required)

## Environment variables (set these in Vercel project settings)
- SUPABASE_URL
- SUPABASE_SERVICE_ROLE_KEY   (use service role key, keep secret)
- RESEND_API_KEY              (for sending emails)
- ADMIN_EMAIL                 (email to receive notifications)
- ADMIN_API_KEY               (a secret used to protect admin endpoints)

## Supabase setup SQL
Run these in Supabase SQL editor:
```sql
create table feedback (
  id bigint generated by default as identity primary key,
  name text not null,
  email text not null,
  message text not null,
  created_at timestamptz default now()
);

create table contact_messages (
  id bigint generated by default as identity primary key,
  name text not null,
  email text not null,
  message text not null,
  created_at timestamptz default now()
);
```

## Admin protection note
- This bundle uses a simple `ADMIN_API_KEY` header (`x-admin-key`) check to protect admin endpoints.
- **To use Clerk-based verification**, replace the `isAdmin` function with Clerk server-side token verification and check the user's public metadata for `role: "admin"`. See Clerk docs for server SDK usage.

## Deploying to Vercel
1. Create a new project in Vercel and link your GitHub repo.
2. Add the environment variables above in Vercel dashboard.
3. Push the code — Vercel will auto-deploy the `api/` endpoints as serverless functions.
